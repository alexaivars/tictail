/*
 * Swipe 2.0
 * Brad Birdsall
 * Copyright 2012, Licensed GPL & MIT
*/
window.Swipe=function(element,options){var _this=this;if(!element)return;this.container=element;this.element=this.container.children[0];this.browser={touch:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}(),transitions:function(){var temp=document.createElement("swipe"),props=["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"];for(var i in props){if(temp.style[props[i]]!==undefined)return true}return false}()};options=options||{};this.index=options.startSlide||0;this.speed=options.speed||300;this.callback=options.callback||function(){};this.transitionEnd=options.transitionEnd||function(){};this.delay=options.auto||0;this.cont=options.continuous!=undefined?!!options.continuous:true;this.disableScroll=!!options.disableScroll;this.index=parseInt(this.index,10);this.setup();this.begin();if(this.element.addEventListener){if(!!this.browser.touch){this.element.addEventListener("touchstart",this,false);this.element.addEventListener("touchmove",this,false);this.element.addEventListener("touchend",this,false)}if(!!this.browser.transitions){this.element.addEventListener("webkitTransitionEnd",this,false);this.element.addEventListener("msTransitionEnd",this,false);this.element.addEventListener("oTransitionEnd",this,false);this.element.addEventListener("transitionend",this,false)}window.addEventListener("resize",this,false)}else{window.onresize=function(){_this.setup()}}};Swipe.prototype={setup:function(){this.slides=this.element.children;this.length=this.slides.length;this.cache=new Array(this.length);if(this.length<2)return;this.width=this.container.getBoundingClientRect().width||this.container.offsetWidth;if(!this.width)return;var refArray=[[],[],[]];this.element.style.width=this.slides.length*this.width+"px";for(var index=this.length-1;index>-1;index--){var elem=this.slides[index];elem.style.width=this.width+"px";elem.setAttribute("data-index",index);if(this.browser.transitions){elem.style.left=index*-this.width+"px"}refArray[this.index>index?0:this.index<index?2:1].push(index)}if(this.browser.transitions){this._stack(refArray[0],-1);this._stack(refArray[1],0);this._stack(refArray[2],1)}else{this.element.style.left=this.index*-this.width+"px"}this.container.style.visibility="visible"},kill:function(){this.delay=0;clearTimeout(this.interval);var slideArray=[];for(var i=this.slides.length-1;i>=0;i--){this.slides[i].style.width="";slideArray.push(i)}this._stack(slideArray,0);var elem=this.element;elem.className=elem.className.replace("swipe-active","");if(this.element.removeEventListener){if(!!this.browser.touch){this.element.removeEventListener("touchstart",this,false);this.element.removeEventListener("touchmove",this,false);this.element.removeEventListener("touchend",this,false)}if(!!this.browser.transitions){this.element.removeEventListener("webkitTransitionEnd",this,false);this.element.removeEventListener("msTransitionEnd",this,false);this.element.removeEventListener("oTransitionEnd",this,false);this.element.removeEventListener("transitionend",this,false)}window.removeEventListener("resize",this,false)}else{window.onresize=null}},getPos:function(){return this.index},prev:function(delay){this.delay=delay||0;clearTimeout(this.interval);if(this.index)this.slide(this.index-1,this.speed);else if(this.cont)this.slide(this.length-1,this.speed)},next:function(delay){this.delay=delay||0;clearTimeout(this.interval);if(this.index<this.length-1)this.slide(this.index+1,this.speed);else if(this.cont)this.slide(0,this.speed)},begin:function(){var _this=this;this.interval=this.delay?setTimeout(function(){_this.next(_this.delay)},this.delay):0},handleEvent:function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onTouchEnd(e);break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":this.onTransitionEnd(e);break;case"resize":this.setup();break}e.stopPropagation()},onTouchStart:function(e){var _this=this;_this.start={pageX:e.touches[0].pageX,pageY:e.touches[0].pageY,time:Number(new Date)};_this.isScrolling=undefined;_this.deltaX=0},onTouchMove:function(e){var _this=this;if(e.touches.length>1||e.scale&&e.scale!==1)return;_this.deltaX=e.touches[0].pageX-_this.start.pageX;if(typeof _this.isScrolling=="undefined"){_this.isScrolling=!!(_this.isScrolling||Math.abs(_this.deltaX)<Math.abs(e.touches[0].pageY-_this.start.pageY))}if(!_this.isScrolling){e.preventDefault();_this.delay=0;clearTimeout(_this.interval);_this.deltaX=_this.deltaX/(!_this.index&&_this.deltaX>0||_this.index==_this.length-1&&_this.deltaX<0?Math.abs(_this.deltaX)/_this.width+1:1);_this._move([_this.index-1,_this.index,_this.index+1],_this.deltaX)}else if(_this.disableScroll){e.preventDefault()}},onTouchEnd:function(e){var _this=this;var isValidSlide=Number(new Date)-_this.start.time<250&&Math.abs(_this.deltaX)>20||Math.abs(_this.deltaX)>_this.width/2,isPastBounds=!_this.index&&_this.deltaX>0||_this.index==_this.length-1&&_this.deltaX<0,direction=_this.deltaX<0;if(!_this.isScrolling){if(isValidSlide&&!isPastBounds){if(direction){_this._stack([_this.index-1],-1);_this._slide([_this.index,_this.index+1],-_this.width,_this.speed);_this.index+=1}else{_this._stack([_this.index+1],1);_this._slide([_this.index-1,_this.index],_this.width,_this.speed);_this.index+=-1}_this.callback(_this.index,_this.slides[_this.index])}else{_this._slide([_this.index-1,_this.index,_this.index+1],0,_this.speed)}}},onTransitionEnd:function(e){if(this._getElemIndex(e.target)==this.index){if(this.delay)this.begin();this.transitionEnd(this.index,this.slides[this.index])}},slide:function(to,speed){var from=this.index;if(from==to)return;var speed=typeof speed==="undefined"?this.speed:speed;if(this.browser.transitions){var toStack=Math.abs(from-to)-1,direction=Math.abs(from-to)/(from-to),inBetween=[];while(toStack--)inBetween.push((to>from?to:from)-toStack-1);this._stack(inBetween,direction);this._slide([from,to],this.width*direction,speed)}else{this._animate(from*-this.width,to*-this.width,speed)}this.index=to;this.callback(this.index,this.slides[this.index])},_slide:function(nums,dist,speed){var _slides=this.slides,l=nums.length;while(l--){this._translate(_slides[nums[l]],dist+this.cache[nums[l]],speed?speed:0);this.cache[nums[l]]+=dist}},_stack:function(nums,pos){var _slides=this.slides,l=nums.length,dist=this.width*pos;while(l--){this._translate(_slides[nums[l]],dist,0);this.cache[nums[l]]=dist}},_move:function(nums,dist){var _slides=this.slides,l=nums.length;while(l--)this._translate(_slides[nums[l]],dist+this.cache[nums[l]],0)},_translate:function(elem,xval,speed){if(!elem)return;var style=elem.style;style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=speed+"ms";style.webkitTransform="translate("+xval+"px,0)"+"translateZ(0)";style.msTransform=style.MozTransform=style.OTransform="translateX("+xval+"px)"},_animate:function(from,to,speed){var elem=this.element;if(!speed){elem.style.left=to+"px";return}var _this=this,start=new Date,timer=setInterval(function(){var timeElap=new Date-start;if(timeElap>speed){elem.style.left=to+"px";if(_this.delay)_this.begin();_this.transitionEnd(_this.index,_this.slides[_this.index]);clearInterval(timer);return}elem.style.left=(to-from)*(Math.floor(timeElap/speed*100)/100)+from+"px"},4)},_getElemIndex:function(elem){return parseInt(elem.getAttribute("data-index"),10)}};if(window.jQuery||window.Zepto){(function($){$.fn.Swipe=function(params){return this.each(function(){var _this=$(this);_this.data("Swipe",new Swipe(_this[0],params))})}})(window.jQuery||window.Zepto)}
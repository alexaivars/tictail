/*! Kramgo Tictail Theme - v0.1.0 - copyrightish (c) 2013-05-22 Alexander Aivars, Kramgo AB */(function(){var t,e,i,n,r,s;n=!1,i=!1,e=null,t="index",s=null,r=function(){var t,i,n,r,o,h,a,l,c,u,d,p;if(o=$(".variations_select_label"),o.length)for(h=0,c=o.length;c>h;h++)i=o[h],r=new krmg.SelectLable(i);if(krmg.ProductList.flush().load(),krmg.ProductList.index(),krmg.LazyImage.init(),krmg.LazyImage.load(),e.resize(),$(".product_slide_figure img").on("dragstart",function(t){return t.preventDefault(),!1}),o=$(".product_single"),o.length)for(a=0,u=o.length;u>a;a++)i=o[a],s=new krmg.Product($(i));if(o=$(".html_content"),o.length){for(p=[],l=0,d=o.length;d>l;l++)t=o[l],n=krmg.ELEMENT.insertLater(t),krmg.ELEMENT.wash(t),t.className=t.className.replace(/html_content\s*/,""),p.push(n());return p}},$(document).ready(function(){var i;return e=new krmg.SlideMenu($(".page_body").first()),r(),i=".page_column",$.sammy(i,function(){return this.get("/",function(e){"index"!==t&&e.load("/").then(function(t){krmg.HTML.read(t,i),r()})}),this.get(/products\/(.*)/,function(e){var n;return n=e.params.splat[0],t=n,e.load("/products/"+n).then(function(t){krmg.HTML.read(t,i),r()})}),this.get(/product\/(.*)/,function(t){var e,i;e=t.params.splat[0],i=$(".page_column a[href$='product/"+e+"']"),$(".page_column .selected").removeClass("selected"),i.addClass("selected"),krmg.ProductList.show(this.path)}),this.get(/page\/(.*)/,function(e){var n;n=e.params.splat[0],t=n,e.load("/page/"+n).then(function(t){return krmg.ProductList.flush(),krmg.HTML.read(t,i),r()})}),this.bind("event-context-after",function(){var t;t=$("a[href$='"+this.path.replace(/^\/\#|^\//,"")+"']"),$("a.selected").removeClass("selected"),t.length?t.addClass("selected"):$("a[href='/']").addClass("selected"),e.close()})}).run()}),$(window).on("scroll",function(){return n?void 0:(n=!0,window.requestAnimationFrame(function(){return krmg.LazyImage.load(),n=!1}))}),$(window).on("resize",function(){return i?void 0:(i=!0,window.requestAnimationFrame(function(){return krmg.ProductList.index(),krmg.LazyImage.load(),s&&(s.size("load"),s.size("write"),s.swipe.setup()),i=!1}))})}).call(this),function(){var t,e,i,n,r;null==(r=(n="undefined"!=typeof exports&&null!==exports?exports:this).krmg)&&(n.krmg={}),t="data-src",i=[],e=function(t,e){var i,n;return i=t.offsetParent,n=t.parentNode.getBoundingClientRect(),0===n.top?i?n=i.getBoundingClientRect():!1:n.top>=0&&e>=n.top||n.bottom>=0&&e>=n.bottom},krmg.LazyImage={init:function(){var e,n,r,s;for(n=document.getElementsByTagName("img"),r=0,s=n.length;s>r;r++)e=n[r],null!=e.getAttribute(t)&&i.push(e);return this},load:function(){var t,n,r,s,o,h,a;for(t=window.innerHeight||document.documentElement.clientHeight,r=[],s=0,h=i.length;h>s;s++)n=i[s],e(n,t)&&r.push(n);for(o=0,a=r.length;a>o;o++)n=r[o],this.get(n);return this},get:function(e){var i;return i=e.getAttribute(t),e.src!==i&&(e.src=i),this}}}.call(this),function(){var t,e;null==(e=(t="undefined"!=typeof exports&&null!==exports?exports:this).krmg)&&(t.krmg={}),krmg.SlideMenu=function(){function t(t){var e=this;this.container=t,this.menu=$(".page_menu").first(),this.tt=$("#tt_colophon").first(),this.content=[this.menu,this.container],this.tt.length&&this.content.push(this.tt),this.touch=Hammer(this.container),this.touch.on("dragstart dragleft dragright swipeleft swiperight release dragup dragdown",function(t){return e.touchHandler(t)}),this.navigation=this.container.find(".page_navigation").first(),this.width=256,this.close(),Hammer($("[data-action=menu-toggle]").first()).on("tap",function(t){return e.actionHandler(t)}),document.getElementById("tictail_search_box").disabled=!0,$(window).on("resize",function(){return e.resize()}),this.resize()}return t.prototype.actionHandler=function(t){return t.stopPropagation(),t.preventDefault(),"open"===this.state?this.close():this.open()},t.prototype.touchHandler=function(t){var e;if(!(t.result&&t.result instanceof krmg.Swipe))switch(t.type){case"dragstart":t.target&&"product_slide_figure"===t.target.className&&(this.ignore=!0);break;case"dragup":case"dragdown":this.change?(t.preventDefault(),t.gesture.preventDefault()):this.ignore=!0;break;case"dragright":case"dragleft":if(this.ignore)return;this.change=!0,t.preventDefault(),t.gesture.preventDefault(),e="open"===this.state?Math.max(0,Math.min(this.width,this.width+t.gesture.deltaX)):Math.max(0,Math.min(this.width,t.gesture.deltaX)),TweenLite.set(this.content,{x:e,overwrite:!0});break;case"swiperight":if(this.ignore)return;t.preventDefault(),this.open();break;case"swipeleft":if(this.ignore)return;t.preventDefault(),this.close();break;case"release":t.preventDefault(),this.change&&(Math.abs(t.gesture.deltaX)>.5*this.width?"open"===this.state?this.close():this.open():"open"===this.state?this.open():this.close()),this.ignore=!1,this.change=!1}},t.prototype.resize=function(){return this.navigation.css({minHeight:"auto"}),this.container.height()<$(window).height()&&this.navigation.css({minHeight:$(window).height()}),this},t.prototype.open=function(){var t=this;return TweenLite.to(this.content,.25,{x:this.width,overwrite:!0,onComplete:function(){return t.state="open",setTimeout(function(){return document.getElementById("tictail_search_box").disabled=!1},400)}})},t.prototype.close=function(){var t=this;return TweenLite.to(this.content,.25,{x:0,overwrite:!0,onComplete:function(){return t.state="closed",document.getElementById("tictail_search_box").disabled=!0}})},t}()}.call(this),function(){var t,e;t=function(t){var e,i;return i=t.parentNode,e=t.nextSibling,i.removeChild(t),function(){return e?i.insertBefore(t,e):i.appendChild(t)}},e=function(t){var i,n,r,s;if(t.removeAttribute("style"),t.children.length)for(s=t.children,n=0,r=s.length;r>n;n++)i=s[n],e(i);return t},$(document).ready(function(){var i,n,r,s,o;if(r=$(".html_content"),r.length)for(s=0,o=r.length;o>s;s++)i=r[s],n=t(i),e(i),i.className=i.className.replace(/html_content\s*/,""),n()})}.call(this),function(){var t,e,i;t=function(){function t(){this.list=[],this.first=[]}return t.prototype.show=function(t){var e,i,n,r,s,o,h,a,l;for(t=t.replace(krmg.RE.clean,""),e=null,a=this.list,r=0,o=a.length;o>r;r++)n=a[r],n.url===t&&(e=n);if(e){for(l=this.list,s=0,h=l.length;h>s;s++)n=l[s],n!==e&&n.row===e.row&&n.select(!1);return this.active=e,this.insert_detail(e,e.row+1),e.select(),i=0,TweenLite.to(window,.25,{scrollTo:{y:e.detail.offset().top-i,x:$(window).scrollLeft()},ease:Power2.easeIn}),this}},t.prototype.insert_detail=function(t,e){var i,n,r;this.container||(this.container=$(".product_list")),r=null,i=t.detail[0],n=t.container.parent()[0],this.first[e]&&(r=this.first[e].container[0]);try{n.insertBefore(i,r)}catch(s){console.log(s)}return this},t.prototype.load=function(){var t,e,i,n;if(e=$(".product_list .product"),e.length)for(i=0,n=e.length;n>i;i++)t=e[i],this.list.push(new krmg.Product($(t)));return this},t.prototype.index=function(){var t,e,i,n,r,s,o,h,a,l,c,u,d,p,f,g,m,w,v,y,x,b,k;for(r=s=-1,e=[];this.first.length;)this.first.pop();for(v=this.list,o=0,c=v.length;c>o;o++)t=v[o],t.selected&&(t.select(!1),e.push(t));for(y=this.list,h=0,u=y.length;u>h;h++)t=y[h],t.size("reset");for(x=this.list,a=0,d=x.length;d>a;a++)t=x[a],t.size("load");for(b=this.list,l=0,p=b.length;p>l;l++)t=b[l],t.size("write");for(k=this.list,m=0,f=k.length;f>m;m++)t=k[m],t.size().top>s&&(r++,this.first[r]=t),t.row=r,s=t.size().top;if(i=-1,this.active)for(w=0,g=e.length;g>w;w++)t=e[w],n=t.row+1,(t===this.active||t.row!==this.active.row&&n!==i)&&(this.insert_detail(t,n),t.select(!0),i=n);return this},t.prototype.flush=function(){for(this.active=null;this.first.length;)this.first.pop();for(;this.list.length;)this.list.pop()["delete"]();return this},t}(),null==(i=(e="undefined"!=typeof exports&&null!==exports?exports:this).krmg)&&(e.krmg={}),krmg.ProductList=new t}.call(this),function(){var t,e;null==(e=(t="undefined"!=typeof exports&&null!==exports?exports:this).krmg)&&(t.krmg={}),krmg.Product=function(){function t(t){this.container=t,this.teaser=this.container.find(".product_teaser").first(),this.detail=this.container.find(".product_detail").first(),this.slider=this.container.find(".product_slide").first(),this.images=this.container.find(".product_slide_figure img"),this.swipe=null,this.detail.detach(),this.detail.show(),this.row=0,this.url=this.teaser.attr("href").replace(krmg.RE.clean,"")}return t.prototype.select=function(t){var e,i,n,r,s;if(this.selected=null!=t?t:!0,this.selected){for(s=this.images,n=0,r=s.length;r>n;n++)e=s[n],i=e.getAttribute("data-src"),e.removeAttribute("data-src"),null!=i&&(e.src=i);this.swipe?this.swipe&&this.swipe.setup():this.swipe=new krmg.Swipe(this.slider[0],{continuous:!0,disableScroll:!1,stopPropagation:!1,mouse:!0})}else this.detail.detach();return this},t.prototype.size=function(t){return"reset"===t||("load"===t?(this.parent_bounds=this.container.parent()[0].getBoundingClientRect(),this.bounds=this.container[0].getBoundingClientRect()):(t="write")&&this.slider.height(Math.round(this.parent_bounds.width*(2/3)))),this.bounds},t.prototype.top=function(){return this.container.position().top},t.prototype["delete"]=function(){var t;for(t in this)this[t]instanceof jQuery&&this[t].off(),this.hasOwnProperty(t)&&(this[t]=null)},t}()}.call(this),function(){var t,e;null==(e=(t="undefined"!=typeof exports&&null!==exports?exports:this).krmg)&&(t.krmg={}),krmg.SelectLable=function(){function t(t){return this.label=t instanceof jQuery?t:$(t),this.select=this.label.prev(),this.select.hasClass("tictail_variations_select")?(this.setup(),void 0):(this.label=null,this.select=null,void 0)}return t.prototype.prefix="",t.prototype.setup=function(){var t=this;this.select.on("change",function(){return t.changed()}),this.changed()},t.prototype.changed=function(){var t;try{return t=$(this.select[0].options[this.select[0].selectedIndex]),this.label.html(t[0].innerHTML)}catch(e){return console.log(e)}},t}()}.call(this),function(){var t,e;null==(e=(t="undefined"!=typeof exports&&null!==exports?exports:this).krmg)&&(t.krmg={}),krmg.Swipe=function(){function t(t,e){var i,n=this;return this.container=t,this.options=null!=e?e:{},this.wrapper=this.container.children[0],this.index=0,this.speed=400,this.setup(),i={setup:function(){return n.setup(),n},prev:function(){return n.stop(),n.prev(),n},next:function(){return n.stop(),n.next(),n},kill:function(){n.teardown()}},i.__proto__=this.__proto__,i}return t.prototype.stop=function(){return this},t.prototype.prev=function(){return TweenLite.set(this.wrapper,{x:"-="+this.width}),this.index=this.circle(this.index-1),this.layout(),this.move(),this},t.prototype.next=function(){return TweenLite.set(this.wrapper,{x:"+="+this.width}),this.index=this.circle(this.index+1),this.layout(),this.move(),this},t.prototype.circle=function(t){return(this.length+t%this.length)%this.length},t.prototype.teardown=function(){var t,e,i,n;for(this.touch&&this.touch.off(),n=this.slides,e=0,i=n.length;i>e;e++)t=n[e],t.removeAttribute("style");this.wrapper.removeAttribute("style"),this.container.removeAttribute("style"),this.index=0,this.slides=[]},t.prototype.setup=function(){var t,e,i,n,r,s,o,h,a,l=this;if(this.length=this.wrapper.children.length,e=0,this.length>1)for(;5>this.length;)t=this.wrapper.children[e].cloneNode(!0),e++,this.wrapper.appendChild(t),this.length++;for(this.slides=[],this.direction=0,h=this.wrapper.children,n=0,s=h.length;s>n;n++)i=h[n],this.slides.push(i);for(this.bounds=this.container.getBoundingClientRect(),this.width=this.bounds.width,this.height=this.bounds.height,this.wrapper.style.height=""+this.height+"px",this.wrapper.style.width=""+this.width+"px",this.wrapper.style.position="absolute",!this.touch&&this.length>1&&(this.touch=Hammer(this.container),this.touch.on("tap swipeleft dragleft swiperight dragright touch release",function(t){return l.dragHandler(t)}),this.touch.on("click",function(t){return t.preventDefault()}),this.touch.on("dragstart",function(t){return"img"===t.target.tagName.toLowerCase()?t.preventDefault():void 0}),this.options.mouse&&this.touch.on("click mousemove",function(t){var e,i;return i=t.pageY-l.bounds.top,e=t.pageX-l.bounds.left,1!==l.direction&&e>.5*l.width?(l.container.setAttribute("data-direction","next"),l.direction=1):-1!==l.direction&&.5*l.width>e?(l.container.setAttribute("data-direction","prev"),l.direction=-1):void 0})),a=this.slides,r=0,o=a.length;o>r;r++)t=a[r],t.style.width=""+this.width+"px",t.style.height=""+this.height+"px";return this.layout(),this},t.prototype.layout=function(){var t,e,i,n,r;for(r=this.slides,e=i=0,n=r.length;n>i;e=++i)t=r[e],e===this.index?(t.style.left=0,t.style.visibility="visible"):e===this.circle(this.index+1)?(t.style.left=""+1*this.width+"px",t.style.visibility="visible"):e===this.circle(this.index+2)?(t.style.left=""+2*this.width+"px",t.style.visibility="visible"):e===this.circle(this.index-1)?(t.style.left=""+-1*this.width+"px",t.style.visibility="visible"):e===this.circle(this.index-2)?(t.style.left=""+-2*this.width+"px",t.style.visibility="visible"):t.style.visibility="hidden";return this},t.prototype.dragHandler=function(t){var e;switch(null==this.offset&&(this.offset=0),e=Math.min(this.width,Math.max(-this.width,t.gesture.deltaX)),t.type){case"tap":this.options.onClick&&this.options.onClick(t,this.index,this.slides[this.index]);break;case"touch":this.t?(this.offset=Math.round(this.t.target._gsTransform.x),this.t=null):this.offset=0,TweenLite.killTweensOf(this.wrapper);break;case"dragleft":case"dragright":t.gesture.preventDefault(),TweenLite.set(this.wrapper,{x:e,overwrite:!0});break;case"swipeleft":t.gesture.preventDefault(),this.pendingTouch="next";break;case"swiperight":t.gesture.preventDefault(),this.pendingTouch="prev";break;case"release":"prev"===this.pendingTouch||e>Math.min(250,.5*this.width)?this.prev():"next"===this.pendingTouch||Math.max(-250,this.width*-.5)>e?this.next():this.move(!0),this.pendingTouch=null}return this},t.prototype.move=function(t){var e=this;return this.t=TweenLite.to(this.wrapper,this.speed/1e3,{x:0,overwrite:!0,clearProps:"x",onComplete:function(){return e.options.transitionEnd&&!t&&requestAnimationFrame(function(){return e.options.transitionEnd&&!t?e.options.transitionEnd(e,e.index,e.slides[e.index]):void 0}),e.offset=0,e.t=null}})},t}()}.call(this),function(){var t,e;null==(e=(t="undefined"!=typeof exports&&null!==exports?exports:this).krmg)&&(t.krmg={}),krmg.RE={wash1:/<(script|head|style|iframe|frame|noscript)[^\>]*>[\s\S]*?<\/.*?\1>/gi,wash2:/<(!doctype|head|html|body).*?>/gi,wash3:/<\/.*?(head|html|body)>/gi,wash4:/<!--[\s\S]*?-->/gi,clean:/^\/\#|^\/|\#|\/\#/},krmg.HTML={wash:function(t){return t=t.replace(krmg.RE.wash1,""),t=t.replace(krmg.RE.wash2,""),t=t.replace(krmg.RE.wash3,""),t=t.replace(krmg.RE.wash4,"")},read:function(t,e){var i,n;if(t=this.wash(t),n=document,null!=document.implementation&&null!=document.implementation.createHTMLDocument)try{n=document.implementation.createHTMLDocument("")}catch(r){n=document}i=n.createElement("div"),i.innerHTML=t,$(e).first().html($(i).find(e).first().html());try{return TT.store.domReady()}catch(r){return console.log("Missing TT.store.domReady")}}},krmg.ELEMENT={wash:function(t){var e,i,n,r;if(t.removeAttribute("style"),t.children.length)for(r=t.children,i=0,n=r.length;n>i;i++)e=r[i],this.wash(e);return t},insertLater:function(t){var e,i;return i=t.parentNode,e=t.nextSibling,i.removeChild(t),function(){return e?i.insertBefore(t,e):i.appendChild(t)}}}}.call(this);